# 个人德语知识库功能设计

## 功能概述

允许用户上传和管理自己的德语学习资料，形成个性化的知识库。

## 核心功能

### 1. 内容类型支持

#### 1.1 词汇上传
- **格式**: CSV, JSON, TXT
- **内容**:
  ```json
  {
    "word": "das Wort",
    "meaning": "单词",
    "example": "Das ist ein wichtiges Wort.",
    "tags": ["名词", "基础"],
    "difficulty": "A1"
  }
  ```
- **功能**:
  - 批量导入词汇表
  - 自定义标签和分类
  - 添加个人笔记和助记符
  - 导入Anki、Quizlet等格式

#### 1.2 语法笔记
- **格式**: Markdown, TXT
- **内容**:
  ```markdown
  # 动词变位规则

  ## 规则动词
  - 词尾: -e, -st, -t, -en, -t, -en

  ## 不规则动词
  - sein: ich bin, du bist...
  ```
- **功能**:
  - 创建个人语法笔记
  - 添加图表和示例
  - 支持LaTeX数学公式
  - 笔记间相互链接

#### 1.3 阅读材料
- **格式**: PDF, TXT, Markdown
- **内容**:
  - 德语文章
  - 新闻剪报
  - 教材章节
  - 文学作品
- **功能**:
  - 上传文本文件
  - 自动提取词汇
  - 添加翻译和注释
  - 生成阅读理解题

#### 1.4 音频资料
- **格式**: MP3, WAV, M4A
- **内容**:
  - 德语播客
  - 新闻音频
  - 对话录音
  - 教材音频
- **功能**:
  - 上传音频文件
  - 添加转写文本
  - 分段标记
  - 生成听力练习

#### 1.5 视频资料
- **格式**: MP4, MOV
- **功能**:
  - 链接YouTube视频
  - 添加字幕文件
  - 关键时刻标记
  - 提取音频用于听力

### 2. 组织和管理

#### 2.1 文件夹系统
```
我的知识库/
├── 词汇/
│   ├── 基础词汇/
│   ├── 专业词汇/
│   └── 易混淆词/
├── 语法笔记/
│   ├── 动词变位/
│   └── 冠词用法/
├── 阅读材料/
│   ├── 新闻/
│   └── 文学/
└── 听力材料/
    ├── 播客/
    └── 新闻/
```

#### 2.2 标签系统
- 自定义标签
- 智能标签建议
- 标签颜色编码
- 标签组合筛选

#### 2.3 搜索功能
- 全文搜索
- 标签筛选
- 按日期/类型过滤
- 智能推荐相关内容

### 3. 学习集成

#### 3.1 词汇复习
- 将自定义词汇加入复习系统
- 使用FSRS算法安排复习
- 与内置词汇混合练习

#### 3.2 练习生成
- 根据上传材料生成练习
- 自动创建听力题（从音频）
- 自动创建阅读理解（从文本）
- 自动创建填空题（从语法笔记）

#### 3.3 进度追踪
- 追踪自定义材料学习进度
- 统计各类型材料使用情况
- 生成个人学习报告

### 4. 导入导出

#### 4.1 导入格式
- **Anki**: .apkg 格式
- **Quizlet**: 导出的文本/表格
- **CSV/Excel**: 词汇表
- **Markdown**: 笔记文件
- **PDF**: 文档（需解析）

#### 4.2 导出格式
- **Anki**: 生成Anki牌组
- **CSV**: 用于Excel
- **JSON**: 用于其他应用
- **Markdown**: 打包下载
- **PDF**: 生成学习手册

### 5. 云端同步

#### 5.1 数据备份
- 自动备份到云端
- 手动导出本地备份
- 版本历史记录
- 恢复功能

#### 5.2 多设备同步
- 跨设备访问
- 冲突解决机制
- 离线可用
- 增量同步

## 技术实现

### 数据模型
```dart
class UserMaterial {
  final String id;
  final String userId;
  final MaterialType type;  // vocabulary, grammar, reading, audio
  final String title;
  final String content;
  final List<String> tags;
  final DateTime createdAt;
  final DateTime? lastModified;
  final int? fileSize;  // bytes
  final String? filePath;
}

class PersonalNote {
  final String id;
  final String materialId;
  final String note;
  final DateTime createdAt;
}
```

### 服务层
```dart
class UserMaterialService {
  // 上传材料
  Future<void> uploadMaterial(UserMaterial material);

  // 搜索材料
  List<UserMaterial> searchMaterials({
    required String query,
    List<String>? tags,
    MaterialType? type,
  });

  // 添加笔记
  Future<void> addNote(String materialId, String note);

  // 生成练习
  Future<Exercise> generateExercise(String materialId);

  // 导入/导出
  Future<void> importFromFile(String path);
  Future<void> exportTo(String format);
}
```

### UI界面
```
┌─────────────────────────────────────┐
│  我的知识库                          │
├─────────────────────────────────────┤
│  [上传] [导入] [搜索] [设置]         │
├─────────────────────────────────────┤
│  文件夹导航                          │
│  ├── 词汇 (256)                     │
│  ├── 语法笔记 (18)                  │
│  ├── 阅读 (45)                      │
│  └── 听力 (32)                      │
├─────────────────────────────────────┤
│  内容列表                            │
│  ┌─────────────────────────────┐   │
│  │ 📝 基础动词变位笔记          │   │
│  │ 标签: #动词 #语法            │   │
│  │ 最后修改: 2天前              │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 🎧 德国之声新闻_20240208    │   │
│  │ 标签: #新闻 #B2             │   │
│  │ 时长: 5:32                  │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

## 隐私和安全

### 数据隐私
- 用户数据本地加密存储
- 可选择是否云端备份
- 数据所有权归用户
- 符合GDPR标准

### 内容安全
- 扫描病毒和恶意文件
- 限制文件大小
- 文件类型验证
- 用户举报机制

## 实现优先级

### P3阶段（高优先级）
1. ✅ 词汇上传（CSV/JSON格式）
2. ✅ 语法笔记（Markdown）
3. ✅ 基础文件夹系统
4. ✅ 搜索功能

### P4阶段（中优先级）
1. ⏳ 阅读材料上传
2. ⏳ 音频材料上传
3. ⏳ Anki导入/导出
4. ⏳ 自动生成练习

### P5阶段（低优先级）
1. 📅 视频资料支持
2. 📅 云端同步
3. 📅 协作功能
4. 📅 社区分享

## 使用场景

### 场景1: 学生
- 上传课堂笔记
- 整理老师讲义
- 创建个人词汇表
- 复习备考材料

### 场景2: 自学者
- 收集网络资源
- 记录学习心得
- 整理错题本
- 追踪学习进度

### 场景3: 教师
- 准备教学材料
- 共享给学生
- 创建练习题
- 追踪学生进度

## 技术挑战

### 1. 存储管理
- 本地存储空间限制
- 大文件处理
- 文件索引优化

### 2. 格式兼容
- 多种文件格式解析
- 编码问题处理
- 特殊字符支持

### 3. 性能优化
- 大文件上传
- 搜索速度
- 实时预览

## 总结

个人知识库功能将极大地提升Aeryn-Deutsch的个性化和实用性，让用户能够：
- ✅ 建立自己的德语资料库
- ✅ 与App核心功能无缝集成
- ✅ 生成个性化练习
- ✅ 追踪学习进度
- ✅ 随时随地访问

这是向"AI+人工"混合学习模式的重要一步！
